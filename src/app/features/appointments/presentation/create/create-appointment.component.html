<div
  class="flex my-auto mx-auto shadow-sm shadow-surface-100 rounded-sm bg-surface-100">

  <p-stepper [value]="1" class="w-full">
    <p-step-list>
      <p-step [value]="1">Seleccionar Odont√≥logo</p-step>
      <p-step [value]="2" [disabled]="doctorForm.invalid">Seleccionar fecha</p-step>
      <p-step [value]="3" [disabled]="appointmentForm.invalid || !selectedTime">Resumen</p-step>
    </p-step-list>
    <p-step-panels>
      <p-step-panel [value]="1">
        <ng-template pTemplate="content" let-activateCallback="activateCallback">

          <form [formGroup]="appointmentForm">
            <div class="w-11/12 mx-auto">
              <div class="grid grid-cols-3 gap-8">

                @for (doctor of doctors; track doctor.id) {
                  <div
                    class="hover:bg-primary-500/20 hover:rounded-2xl p-4 transform transition motion-reduce:transition-none motion-reduce:hover:transform-none duration-600">
                    <div
                      [ngClass]="(selectedDoctor != null ? selectedDoctor.id.toString() == doctor.id.toString() : false) ? 'bg-surface-500 text-white dark:text-color' : 'bg-surface-0'"
                      (click)="setDoctorId(doctor)"
                      class="flex flex-col justify-between h-64 w-full p-4 rounded-sm focus:outline-none border border-surface-100">
                      <div class="flex flex-row justify-between">
                        <p class="text-2xl">{{ doctor.profile.name }}</p>
                        <p class="text-2xl">{{ doctor.id }}</p>
                      </div>
                      <p class="text-end text-lg">{{ doctor.specialty }}</p>
                    </div>
                  </div>
                }
              </div>
            </div>
          </form>

          <app-paginator [currentPage]="paginatorMeta.current_page"
                         [from]="paginatorMeta.from"
                         [lastPage]="paginatorMeta.last_page"
                         [listOfPages]="paginatorMeta.pages" [to]="paginatorMeta.to"
                         [totalRecords]="paginatorMeta.total"
                         (goFirstPage)="loadDoctors(1)"
                         (prev)="prev()"
                         (next)="next()"
                         (loadItems)="loadDoctors($event)"/>

          <div class="flex p-6 justify-end">
            <app-medium-botton [disabled]="doctorForm.invalid"
                               (click)="onDoctorNext(activateCallback(2))"
                               [title]="'Continuar'"/>
          </div>
        </ng-template>
      </p-step-panel>

      <p-step-panel [value]="2">
        <ng-template pTemplate="content" let-activateCallback="activateCallback">
          <div class="flex flex-row justify-center w-11/12 my-5 mx-auto">
            <form [formGroup]="appointmentForm" class="w-full space-y-4 space-x-4">

              <div class="w-1/2 mx-auto space-y-2">

                <div class="flex">

                  <input id="patient_name" formControlName="patientName"
                         class="dark:bg-surface-50 bg-surface-0 placeholder:text-gray-400 w-full px-4 py-4 rounded-sm focus:outline-none border border-surface-100"
                         placeholder="Nombre del paciente">

                  <input id="patient_name" formControlName="middleName"
                         class="dark:bg-surface-50 bg-surface-0 placeholder:text-gray-400 w-full px-4 py-4 rounded-sm focus:outline-none border border-surface-100"
                         placeholder="Apellidos">
                </div>

                <div class="space-y-2">
                  <p-floatlabel variant="in">
                    <p-datepicker
                      formControlName="date"
                      dateFormat="dd.mm.yy"
                      [showIcon]="true"
                      inputId="buttondisplay"
                      (onSelect)="getAvailableAppointments($event)"
                      id="calendar"
                      appendTo="body"
                      class="w-full"
                    ></p-datepicker>
                    <label for="calendar" class="text-color-label">Fecha de cita</label>
                  </p-floatlabel>

                  @if (availableAppointments.length) {
                    <div class="grid grid-cols-5 gap-2">
                      @for (time of availableAppointments; track time) {
                        <div (click)="setAppointmentTime(time)"
                             [ngClass]="(selectedTime == time) ? 'bg-surface-500 text-white dark:text-color' : 'bg-surface-0'"
                             class="cursor-pointer rounded-sm my-auto mx-auto p-2 space-x-2 items-center">
                          <span class="pi pi-calendar-clock"></span>
                          <label>{{ time }} hrs</label>
                        </div>
                      }
                    </div>
                  }

                  @if (bannerMessage.length) {
                    <label class="text-error-300">
                      {{ bannerMessage }}
                    </label>
                  }
                </div>

                <textarea formControlName="note"
                          class="dark:bg-surface-50 bg-surface-0 placeholder:text-gray-400 w-full px-4 py-4 rounded-sm focus:outline-none border border-surface-100"
                          placeholder="Nota (Opcional)">

                </textarea>

              </div>
            </form>
          </div>

          <div class="flex p-6 justify-end">
            <app-medium-botton [disabled]="appointmentForm.invalid || !selectedTime"
                               (click)="activateCallback(3)"
                               [title]="'Continuar'"/>
          </div>
        </ng-template>
      </p-step-panel>

      <p-step-panel [value]="3">
        <ng-template pTemplate="content">
          <div class="flex justify-center w-1/2 my-5 mx-auto">

            <div
              class="h-11/12 flex flex-col justify-between w-8/12 dark:bg-surface-50 bg-surface-0 rounded-sm focus:outline-none
                    border border-surface-100 text-xl font-normal shadow-md shadow-surface-200 p-4">

              <div class="mb-8">
                <div>
                  <span>Paciente: {{ patientName }}</span>
                </div>

                <p-divider/>

                <div>
                <span>
                  Doctor: {{ selectedDoctor?.profile?.name }}
                </span>
                </div>

                <p-divider/>

                <div>
                  <span>{{ selectedDoctor?.specialty }}</span>
                </div>

                <p-divider/>

                <div>
                  <span>{{ selectedAppointmentDate }}</span>
                </div>

                <p-divider/>

                <div>
                  <span>{{ selectedTime }} horas</span>
                </div>

                <p-divider/>

                <div>
                  <span>Nota</span>

                  <textarea class="w-full bg-surface-50 dark:bg-surface-100/80 p-4" [disabled]="true"
                            [value]="appointmentNote">
                  </textarea>
                </div>
              </div>

              <div class="flex justify-end">
                <app-medium-botton
                  (click)="onSubmit()"
                  [title]="'Generar cita'"/>
              </div>
            </div>
          </div>
        </ng-template>
      </p-step-panel>
    </p-step-panels>
  </p-stepper>
</div>
